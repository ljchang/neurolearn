<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nltools.plotting &#8212; nltools 0.4.4 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

<!-- Google Analytics -->
<script>
  (function (i, s, o, g, r, a, m) {
    i["GoogleAnalyticsObject"] = r;
    (i[r] =
      i[r] ||
      function () {
        (i[r].q = i[r].q || []).push(arguments);
      }),
      (i[r].l = 1 * new Date());
    (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m);
  })(
    window,
    document,
    "script",
    "https://www.google-analytics.com/analytics.js",
    "ga"
  );

  ga("create", "UA-138438649-1", "auto");
  ga("send", "pageview");
</script>
<!-- End Google Analytics -->

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          nltools</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install.html">Installation</a></li>
                <li><a href="../../api.html">API</a></li>
                <li><a href="../../auto_examples/index.html">Tutorials</a></li>
                <li><a href="http://www.github.com/ljchang/nltools">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">TOC <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for nltools.plotting</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">NeuroLearn Plotting Tools</span>
<span class="sd">=========================</span>

<span class="sd">Numerous functions to plot data</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;dist_from_hyperplane_plot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scatterplot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;probability_plot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;roc_plot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_stacked_adjacency&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_mean_label_distance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_between_label_distance&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_silhouette&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_t_brain&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_brain&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plot_interactive_brain&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Luke Chang&quot;</span><span class="p">]</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">fftfreq</span>
<span class="kn">from</span> <span class="nn">nltools.stats</span> <span class="kn">import</span> <span class="n">two_sample_permutation</span><span class="p">,</span> <span class="n">one_sample_permutation</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_glass_brain</span><span class="p">,</span> <span class="n">plot_stat_map</span><span class="p">,</span> <span class="n">view_img</span><span class="p">,</span> <span class="n">view_img_on_surf</span>
<span class="kn">from</span> <span class="nn">nltools.prefs</span> <span class="kn">import</span> <span class="n">MNI_Template</span><span class="p">,</span> <span class="n">resolve_mni_path</span>
<span class="kn">from</span> <span class="nn">nltools.utils</span> <span class="kn">import</span> <span class="n">attempt_to_import</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Optional dependencies</span>
<span class="n">ipywidgets</span> <span class="o">=</span> <span class="n">attempt_to_import</span><span class="p">(</span>
    <span class="s2">&quot;ipywidgets&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ipywidgets&quot;</span><span class="p">,</span>
    <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;interact&quot;</span><span class="p">,</span> <span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;widgets&quot;</span><span class="p">,</span> <span class="s2">&quot;BoundedFloatText&quot;</span><span class="p">,</span> <span class="s2">&quot;BoundedIntText&quot;</span><span class="p">],</span>
<span class="p">)</span>


<div class="viewcode-block" id="plot_interactive_brain"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_interactive_brain">[docs]</a><span class="k">def</span> <span class="nf">plot_interactive_brain</span><span class="p">(</span>
    <span class="n">brain</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">surface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">percentile_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">anatomical</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function leverages nilearn&#39;s new javascript based brain viewer functions to create interactive plotting functionality.</span>

<span class="sd">    Args:</span>
<span class="sd">        brain (nltools.Brain_Data): a Brain_Data instance of 1d or 2d shape (i.e. 3d or 4d volume)</span>
<span class="sd">        threshold (float/str): threshold to initialize the visualization, maybe be a percentile string; default 0</span>
<span class="sd">        surface (bool): whether to create a surface-based plot; default False</span>
<span class="sd">        percentile_threshold (bool): whether to interpret threshold values as percentiles</span>
<span class="sd">        kwargs: optional arguments to nilearn.view_img or nilearn.view_img_on_surf</span>

<span class="sd">    Returns:</span>
<span class="sd">        interactive brain viewer widget</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ipywidgets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;ipywidgets&gt;=5.2.2 is required for interactive plotting. Please install this package manually or install nltools with optional arguments: pip install &#39;nltools[interactive_plots]&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">threshold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;%&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Starting threshold provided as string must end in &#39;%&#39;&quot;</span><span class="p">)</span>
        <span class="n">percentile_threshold</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Percentile thresholding ignores brain mask. Results are likely more liberal than you expect (e.g. with non-interactive plotting)!&quot;</span>
        <span class="p">)</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">brain</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">time_slider</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">max_idx</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">shape</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">brain</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">time_slider</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Brain_Data object is not 1d or 2d&quot;</span><span class="p">)</span>

    <span class="n">thresh_box</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatText</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Threshold&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">time_slider</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="n">max_idx</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span>
            <span class="n">readout_format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Image is 3D&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Volume&quot;</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
    <span class="n">ipywidgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span>
        <span class="n">_viewer</span><span class="p">,</span>
        <span class="n">brain</span><span class="o">=</span><span class="n">ipywidgets</span><span class="o">.</span><span class="n">fixed</span><span class="p">(</span><span class="n">brain</span><span class="p">),</span>
        <span class="n">thresh</span><span class="o">=</span><span class="n">thresh_box</span><span class="p">,</span>
        <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
        <span class="n">percentile_threshold</span><span class="o">=</span><span class="n">percentile_threshold</span><span class="p">,</span>
        <span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">,</span>
        <span class="n">anatomical</span><span class="o">=</span><span class="n">ipywidgets</span><span class="o">.</span><span class="n">fixed</span><span class="p">(</span><span class="n">anatomical</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_viewer</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">percentile_threshold</span><span class="p">,</span> <span class="n">surface</span><span class="p">,</span> <span class="n">anatomical</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">thresh</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">percentile_threshold</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">brain</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">anatomical</span><span class="p">:</span>
        <span class="n">bg_img</span> <span class="o">=</span> <span class="n">anatomical</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bg_img</span> <span class="o">=</span> <span class="s2">&quot;MNI152&quot;</span>
    <span class="n">cut_coords</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cut_coords&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">surface</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">view_img_on_surf</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">view_img</span><span class="p">(</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">bg_img</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="n">cut_coords</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>


<div class="viewcode-block" id="plot_t_brain"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_t_brain">[docs]</a><span class="k">def</span> <span class="nf">plot_t_brain</span><span class="p">(</span>
    <span class="n">objIn</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">thr</span><span class="o">=</span><span class="s2">&quot;unc&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nperm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a brain data object and computes a 1 sample t-test across it&#39;s first axis. If a list is provided will compute difference between brain data objects in list (i.e. paired samples t-test).</span>
<span class="sd">    Args:</span>
<span class="sd">        objIn:(list/Brain_Data) if list will compute difference map first</span>
<span class="sd">        how: (list) whether to plot a glass brain &#39;glass&#39;, 3 view-multi-slice mni &#39;mni&#39;, or both &#39;full&#39;</span>
<span class="sd">        thr: (str) what method to use for multiple comparisons correction unc, fdr, or tfce</span>
<span class="sd">        alpha: (float) p-value threshold</span>
<span class="sd">        nperm: (int) number of permutations for tcfe; default 1000</span>
<span class="sd">        cut_coords: (list) x,y,z coords to plot brain slice</span>
<span class="sd">        kwargs: optionals args to nilearn plot functions (e.g. vmax)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">thr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;unc&quot;</span><span class="p">,</span> <span class="s2">&quot;fdr&quot;</span><span class="p">,</span> <span class="s2">&quot;tfce&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Acceptable threshold methods are &#39;unc&#39;,&#39;fdr&#39;,&#39;tfce&#39;&quot;</span><span class="p">)</span>
    <span class="n">views</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cut_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cut_coords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">88</span><span class="p">,</span> <span class="o">-</span><span class="mi">72</span><span class="p">,</span> <span class="o">-</span><span class="mi">58</span><span class="p">,</span> <span class="o">-</span><span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">46</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">66</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cut_coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;cut_coords must be a list of coordinates like [[xs],[ys],[zs]]&quot;</span>
            <span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;RdBu_r&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">objIn</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objIn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">objIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">objIn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Contrasts should contain only 2 list items!&quot;</span><span class="p">)</span>

    <span class="n">thrDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">thr</span> <span class="o">==</span> <span class="s2">&quot;tfce&quot;</span><span class="p">:</span>
        <span class="n">thrDict</span><span class="p">[</span><span class="s2">&quot;permutation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">thr</span>
        <span class="k">if</span> <span class="n">nperm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nperm</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">thrDict</span><span class="p">[</span><span class="s2">&quot;n_permutations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nperm</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-sample t-test corrected using: TFCE w/ </span><span class="si">%s</span><span class="s2"> permutations&quot;</span> <span class="o">%</span> <span class="n">nperm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">thr</span> <span class="o">==</span> <span class="s2">&quot;unc&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span>
            <span class="n">thrDict</span><span class="p">[</span><span class="n">thr</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-sample t-test uncorrected at p &lt; </span><span class="si">%.3f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">thr</span> <span class="o">==</span> <span class="s2">&quot;fdr&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">thrDict</span><span class="p">[</span><span class="n">thr</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-sample t-test corrected at q &lt; </span><span class="si">%.3f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thrDict</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-sample test unthresholded&quot;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">objIn</span><span class="o">.</span><span class="n">ttest</span><span class="p">(</span><span class="n">threshold_dict</span><span class="o">=</span><span class="n">thrDict</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thrDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;thr_t&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
        <span class="n">plot_glass_brain</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
            <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;lzry&quot;</span><span class="p">,</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">plot_abs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">cut_coords</span><span class="p">):</span>
            <span class="n">plot_stat_map</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
                <span class="n">cut_coords</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">display_mode</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">bg_img</span><span class="o">=</span><span class="n">resolve_mni_path</span><span class="p">(</span><span class="n">MNI_Template</span><span class="p">)[</span><span class="s2">&quot;brain&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;glass&quot;</span><span class="p">:</span>
        <span class="n">plot_glass_brain</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
            <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;lzry&quot;</span><span class="p">,</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">plot_abs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;mni&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">cut_coords</span><span class="p">):</span>
            <span class="n">plot_stat_map</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
                <span class="n">cut_coords</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">display_mode</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">bg_img</span><span class="o">=</span><span class="n">resolve_mni_path</span><span class="p">(</span><span class="n">MNI_Template</span><span class="p">)[</span><span class="s2">&quot;brain&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">del</span> <span class="n">obj</span>
    <span class="k">del</span> <span class="n">out</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_brain"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_brain">[docs]</a><span class="k">def</span> <span class="nf">plot_brain</span><span class="p">(</span><span class="n">objIn</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">thr_upper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thr_lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    More complete brain plotting of a Brain_Data instance</span>
<span class="sd">    Args:</span>
<span class="sd">        obj: (Brain_Data) object to plot</span>
<span class="sd">        how: (str) whether to plot a glass brain &#39;glass&#39;, 3 view-multi-slice mni &#39;mni&#39;, or both &#39;full&#39;</span>
<span class="sd">        thr_upper: (str/float) thresholding of image. Can be string for percentage, or float for data units (see Brain_Data.threshold()</span>
<span class="sd">        thr_lower: (str/float) thresholding of image. Can be string for percentage, or float for data units (see Brain_Data.threshold()</span>
<span class="sd">        save (str): if a string file name or path is provided plots will be saved into this directory appended with the orientation they belong to</span>
<span class="sd">        kwargs: optionals args to nilearn plot functions (e.g. vmax)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">thr_upper</span> <span class="ow">or</span> <span class="n">thr_lower</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">objIn</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="n">thr_upper</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">thr_lower</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">objIn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">views</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="p">]</span>  <span class="c1"># [-88,-72,-58,-38,-26,8,20,34,46]</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;RdBu_r&quot;</span>

    <span class="k">if</span> <span class="n">thr_upper</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">thr_lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting unthresholded image&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thr_upper</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting top </span><span class="si">%s</span><span class="s2"> of voxels&quot;</span> <span class="o">%</span> <span class="n">thr_upper</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thr_upper</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting voxels with stat value &gt;= </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">thr_upper</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thr_lower</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting lower </span><span class="si">%s</span><span class="s2"> of voxels&quot;</span> <span class="o">%</span> <span class="n">thr_lower</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thr_lower</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting voxels with stat value &lt;= </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">thr_lower</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">glass_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_glass.&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
        <span class="n">x_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_x.&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
        <span class="n">y_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_y.&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
        <span class="n">z_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;_z.&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">glass_save</span><span class="p">,</span> <span class="n">x_save</span><span class="p">,</span> <span class="n">y_save</span><span class="p">,</span> <span class="n">z_save</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">saves</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_save</span><span class="p">,</span> <span class="n">y_save</span><span class="p">,</span> <span class="n">z_save</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>
        <span class="n">plot_glass_brain</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
            <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;lzry&quot;</span><span class="p">,</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">plot_abs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">glass_save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">savefile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">saves</span><span class="p">):</span>
            <span class="n">plot_stat_map</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
                <span class="n">cut_coords</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">display_mode</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">bg_img</span><span class="o">=</span><span class="n">resolve_mni_path</span><span class="p">(</span><span class="n">MNI_Template</span><span class="p">)[</span><span class="s2">&quot;brain&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;glass&quot;</span><span class="p">:</span>
        <span class="n">plot_glass_brain</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
            <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;lzry&quot;</span><span class="p">,</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">plot_abs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">glass_save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;mni&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">savefile</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">saves</span><span class="p">):</span>
            <span class="n">plot_stat_map</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
                <span class="n">cut_coords</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                <span class="n">display_mode</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">bg_img</span><span class="o">=</span><span class="n">resolve_mni_path</span><span class="p">(</span><span class="n">MNI_Template</span><span class="p">)[</span><span class="s2">&quot;brain&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefile</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">obj</span>  <span class="c1"># save memory</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="dist_from_hyperplane_plot"><a class="viewcode-back" href="../../api.html#nltools.plotting.dist_from_hyperplane_plot">[docs]</a><span class="k">def</span> <span class="nf">dist_from_hyperplane_plot</span><span class="p">(</span><span class="n">stats_output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot SVM Classification Distance from Hyperplane</span>

<span class="sd">    Args:</span>
<span class="sd">        stats_output: a pandas file with prediction output</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: Will return a seaborn plot of distance from hyperplane</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;dist_from_hyperplane_xval&quot;</span> <span class="ow">in</span> <span class="n">stats_output</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span>
            <span class="s2">&quot;subject_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist_from_hyperplane_xval&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span>
            <span class="s2">&quot;subject_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist_from_hyperplane_all&quot;</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;point&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Distance from Hyperplane&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Classification&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="scatterplot"><a class="viewcode-back" href="../../api.html#nltools.plotting.scatterplot">[docs]</a><span class="k">def</span> <span class="nf">scatterplot</span><span class="p">(</span><span class="n">stats_output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot Prediction Scatterplot</span>

<span class="sd">    Args:</span>
<span class="sd">        stats_output: a pandas file with prediction output</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: Will return a seaborn scatterplot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s2">&quot;yfit_xval&quot;</span> <span class="ow">in</span> <span class="n">stats_output</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;yfit_xval&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;yfit_all&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted Value&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="probability_plot"><a class="viewcode-back" href="../../api.html#nltools.plotting.probability_plot">[docs]</a><span class="k">def</span> <span class="nf">probability_plot</span><span class="p">(</span><span class="n">stats_output</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot Classification Probability</span>

<span class="sd">    Args:</span>
<span class="sd">        stats_output: a pandas file with prediction output</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: Will return a seaborn scatterplot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;Probability_xval&quot;</span> <span class="ow">in</span> <span class="n">stats_output</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Probability_xval&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Probability_all&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">stats_output</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted Probability&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">return</span></div>

    <span class="c1"># # and plot the result</span>
    <span class="c1"># plt.figure(1, figsize=(4, 3))</span>
    <span class="c1"># plt.clf()</span>
    <span class="c1"># plt.scatter(X.ravel(), y, color=&#39;black&#39;, zorder=20)</span>
    <span class="c1"># X_test = np.linspace(-5, 10, 300)</span>

    <span class="c1"># def model(x):</span>
    <span class="c1">#     return 1 / (1 + np.exp(-x))</span>
    <span class="c1"># loss = model(X_test * clf.coef_ + clf.intercept_).ravel()</span>
    <span class="c1"># plt.plot(X_test, loss, color=&#39;blue&#39;, linewidth=3)</span>


<div class="viewcode-block" id="roc_plot"><a class="viewcode-back" href="../../api.html#nltools.plotting.roc_plot">[docs]</a><span class="k">def</span> <span class="nf">roc_plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot 1-Specificity by Sensitivity</span>

<span class="sd">    Args:</span>
<span class="sd">        fpr: false positive rate from Roc.calculate</span>
<span class="sd">        tpr: true positive rate from Roc.calculate</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig: Will return a matplotlib ROC plot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># fig = sns.tsplot(tpr,fpr,color=&#39;red&#39;,linewidth=3)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;(1 - Specificity)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Sensitivity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ROC Plot&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_stacked_adjacency"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_stacked_adjacency">[docs]</a><span class="k">def</span> <span class="nf">plot_stacked_adjacency</span><span class="p">(</span><span class="n">adjacency1</span><span class="p">,</span> <span class="n">adjacency2</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create stacked adjacency to illustrate similarity.</span>

<span class="sd">    Args:</span>
<span class="sd">        matrix1:  Adjacency instance 1</span>
<span class="sd">        matrix2:  Adjacency instance 2</span>
<span class="sd">        normalize: (boolean) Normalize matrices.</span>

<span class="sd">    Returns:</span>
<span class="sd">        matplotlib figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">nltools.data</span> <span class="kn">import</span> <span class="n">Adjacency</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency1</span><span class="p">,</span> <span class="n">Adjacency</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency2</span><span class="p">,</span> <span class="n">Adjacency</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This function requires Adjacency() instances as input.&quot;</span><span class="p">)</span>

    <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">adjacency2</span><span class="o">.</span><span class="n">squareform</span><span class="p">(),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">adjacency1</span><span class="o">.</span><span class="n">squareform</span><span class="p">(),</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">((</span><span class="n">adjacency1</span> <span class="o">-</span> <span class="n">adjacency1</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">squareform</span><span class="p">(),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">((</span><span class="n">adjacency2</span> <span class="o">-</span> <span class="n">adjacency2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">squareform</span><span class="p">(),</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">+</span> <span class="n">lower</span>
    <span class="k">return</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">dist</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="plot_mean_label_distance"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_mean_label_distance">[docs]</a><span class="k">def</span> <span class="nf">plot_mean_label_distance</span><span class="p">(</span>
    <span class="n">distance</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">permutation_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">n_permute</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a violin plot indicating within and between label distance.</span>

<span class="sd">    Args:</span>
<span class="sd">        distance:  pandas dataframe of distance</span>
<span class="sd">        labels: labels indicating columns and rows to group</span>
<span class="sd">        ax: matplotlib axis to plot on</span>
<span class="sd">        permutation_test: (bool) indicates whether to run permuatation test or not</span>
<span class="sd">        n_permute: (int) number of permutations to run</span>
<span class="sd">        fontsize: (int) fontsize for plot labels</span>
<span class="sd">    Returns:</span>
<span class="sd">        f: heatmap</span>
<span class="sd">        stats: (optional if permutation_test=True) permutation results</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;distance must be a pandas dataframe&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">distance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">distance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;distance must be square.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="n">distance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Labels must be same length as distance matrix&quot;</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">tmp_w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">tmp_w</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">tmp_w</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Within&quot;</span>
        <span class="n">tmp_w</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">tmp_b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Between&quot;</span>
        <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_w</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_b</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inner</span><span class="o">=</span><span class="s2">&quot;quartile&quot;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Within&quot;</span><span class="p">:</span> <span class="s2">&quot;lightskyblue&quot;</span><span class="p">,</span> <span class="s2">&quot;Between&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">},</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Average Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Average Group Distance&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">permutation_test</span><span class="p">:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="c1"># Between group test</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Within&quot;</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span><span class="p">]</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Between&quot;</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span><span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">two_sample_permutation</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">n_permute</span><span class="o">=</span><span class="n">n_permute</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span></div>


<div class="viewcode-block" id="plot_between_label_distance"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_between_label_distance">[docs]</a><span class="k">def</span> <span class="nf">plot_between_label_distance</span><span class="p">(</span>
    <span class="n">distance</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">permutation_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">n_permute</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a heatmap indicating average between label distance</span>


<span class="sd">    Args:</span>
<span class="sd">        distance: (pandas dataframe) brain_distance matrix</span>
<span class="sd">        labels: (pandas dataframe) group labels</span>
<span class="sd">        ax: axis to plot (default=None)</span>
<span class="sd">        permutation_test: (boolean)</span>
<span class="sd">        n_permute: (int) number of samples for permuation test</span>
<span class="sd">        fontsize: (int) size of font for plot</span>
<span class="sd">    Returns:</span>
<span class="sd">        f: heatmap</span>
<span class="sd">        out: pandas dataframe of pairwise distance between conditions</span>
<span class="sd">        within_dist_out: average pairwise distance matrix</span>
<span class="sd">        mn_dist_out: (optional if permutation_test=True) average difference in distance between conditions</span>
<span class="sd">        p_dist_out: (optional if permutation_test=True) p-value for difference in distance between conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Group&quot;</span><span class="p">,</span> <span class="s2">&quot;Comparison&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">tmp_b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">j</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
            <span class="n">tmp_b</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_b</span><span class="p">)</span>

    <span class="n">within_dist_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))),</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
        <span class="n">index</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">within_dist_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">)</span>
            <span class="p">][</span><span class="s2">&quot;Distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">permutation_test</span><span class="p">:</span>
        <span class="n">mn_dist_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">p_dist_out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))),</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">tmp1</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span>
                <span class="p">]</span>
                <span class="n">tmp2</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;Comparison&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">),</span> <span class="s2">&quot;Distance&quot;</span>
                <span class="p">]</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">two_sample_permutation</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">n_permute</span><span class="o">=</span><span class="n">n_permute</span><span class="p">)</span>
                <span class="n">mn_dist_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
                <span class="n">p_dist_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mn_dist_out</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
            <span class="n">mn_dist_out</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">p_dist_out</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">within_dist_out</span><span class="p">,</span> <span class="n">mn_dist_out</span><span class="p">,</span> <span class="n">p_dist_out</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">within_dist_out</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">within_dist_out</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_silhouette"><a class="viewcode-back" href="../../api.html#nltools.plotting.plot_silhouette">[docs]</a><span class="k">def</span> <span class="nf">plot_silhouette</span><span class="p">(</span>
    <span class="n">distance</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">permutation_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_permute</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a silhouette plot indicating between relative to within label distance</span>

<span class="sd">    Args:</span>
<span class="sd">        distance: (pandas dataframe) brain_distance matrix</span>
<span class="sd">        labels: (pandas dataframe) group labels</span>
<span class="sd">        ax: axis to plot (default=None)</span>
<span class="sd">        permutation_test: (boolean)</span>
<span class="sd">        n_permute: (int) number of samples for permuation test</span>
<span class="sd">    Optional keyword args:</span>
<span class="sd">        figsize: (list) dimensions of silhouette plot</span>
<span class="sd">        colors: (list) color triplets for silhouettes. Length must equal number of unique labels</span>
<span class="sd">    Returns:</span>
<span class="sd">        # f: heatmap</span>
<span class="sd">        # out: pandas dataframe of pairwise distance between conditions</span>
<span class="sd">        # within_dist_out: average pairwise distance matrix</span>
<span class="sd">        # mn_dist_out: (optional if permutation_test=True) average difference in distance between conditions</span>
<span class="sd">        # p_dist_out: (optional if permutation_test=True) p-value for difference in distance between conditions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define label set</span>
    <span class="n">labelSet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
    <span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labelSet</span><span class="p">)</span>

    <span class="c1"># Set defaults for plot design</span>
    <span class="k">if</span> <span class="s2">&quot;colors&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;figsize&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Compute silhouette scores</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;MeanWit&quot;</span><span class="p">,</span> <span class="s2">&quot;MeanBet&quot;</span><span class="p">,</span> <span class="s2">&quot;Sil&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">sameIndices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">labelcur</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">labelcur</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">within</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">sameIndices</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">otherIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">labelcur</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">labelcur</span> <span class="o">!=</span> <span class="n">label</span><span class="p">)]</span>
        <span class="n">between</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">otherIndices</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">silhouetteScore</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">between</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">within</span><span class="p">))</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">between</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">within</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">out_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">out_tmp</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">out_tmp</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">out_tmp</span><span class="p">[</span><span class="s2">&quot;MeanWit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">within</span><span class="p">)</span>
        <span class="n">out_tmp</span><span class="p">[</span><span class="s2">&quot;MeanBet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">between</span><span class="p">)</span>
        <span class="n">out_tmp</span><span class="p">[</span><span class="s2">&quot;Sil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">silhouetteScore</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out_tmp</span><span class="p">)</span>
    <span class="n">sample_silhouette_values</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Sil&quot;</span><span class="p">]</span>

    <span class="c1"># Plot</span>
    <span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">x_lower</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">labelX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">labelInd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">labelSet</span><span class="p">[</span><span class="n">labelInd</span><span class="p">]</span>
        <span class="n">ith_cluster_silhouette_values</span> <span class="o">=</span> <span class="n">sample_silhouette_values</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
        <span class="n">ith_cluster_silhouette_values</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">size_cluster_i</span> <span class="o">=</span> <span class="n">ith_cluster_silhouette_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_upper</span> <span class="o">=</span> <span class="n">x_lower</span> <span class="o">+</span> <span class="n">size_cluster_i</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">labelInd</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">sns</span><span class="o">.</span><span class="n">axes_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_lower</span><span class="p">,</span> <span class="n">x_upper</span><span class="p">),</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">ith_cluster_silhouette_values</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">labelX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">labelX</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x_lower</span><span class="p">,</span> <span class="n">x_upper</span><span class="p">])))</span>
        <span class="n">x_lower</span> <span class="o">=</span> <span class="n">x_upper</span> <span class="o">+</span> <span class="mi">3</span>

    <span class="c1"># Format plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">labelX</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labelSet</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Silhouettes&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_clusters</span> <span class="o">*</span> <span class="mi">3</span><span class="p">])</span>

    <span class="c1"># Permutation test on mean silhouette score per label</span>
    <span class="k">if</span> <span class="n">permutation_test</span><span class="p">:</span>
        <span class="n">outAll</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">labelInd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">outAll</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labelSet</span><span class="p">[</span><span class="n">labelInd</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">sample_silhouette_values</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labelInd</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">labelInd</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Only test positive mean silhouette scores</span>
                <span class="n">statsout</span> <span class="o">=</span> <span class="n">one_sample_permutation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_permute</span><span class="o">=</span><span class="n">n_permute</span><span class="p">)</span>
                <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">statsout</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>
            <span class="n">outAll</span> <span class="o">=</span> <span class="n">outAll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outAll</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>


<span class="k">def</span> <span class="nf">component_viewer</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">tr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This a function to interactively view the results of a decomposition analysis</span>

<span class="sd">    Args:</span>
<span class="sd">        output: (dict) output dictionary from running Brain_data.decompose()</span>
<span class="sd">        tr: (float) repetition time of data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ipywidgets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;ipywidgets is required for interactive plotting. Please install this package manually or install nltools with optional arguments: pip install &#39;nltools[interactive_plots]&#39;&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">component_inspector</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This a function to be used with ipywidgets to interactively view a decomposition analysis</span>

<span class="sd">        Make sure you have tr and output assigned to variables.</span>

<span class="sd">        Example:</span>

<span class="sd">            from ipywidgets import BoundedFloatText, BoundedIntText</span>
<span class="sd">            from ipywidgets import interact</span>

<span class="sd">            tr = 2.4</span>
<span class="sd">            output = data_filtered_smoothed.decompose(algorithm=&#39;ica&#39;, n_components=30, axis=&#39;images&#39;, whiten=True)</span>

<span class="sd">            interact(component_inspector, component=BoundedIntText(description=&#39;Component&#39;, value=0, min=0, max=len(output[&#39;components&#39;])-1),</span>
<span class="sd">                  threshold=BoundedFloatText(description=&#39;Threshold&#39;, value=2.0, min=0, max=4, step=.1))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">thresholded</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="n">component</span><span class="p">]</span> <span class="o">-</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">thresholded</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">thresholded</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plot_stat_map</span><span class="p">(</span>
            <span class="n">thresholded</span><span class="o">.</span><span class="n">to_nifti</span><span class="p">(),</span>
            <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">display_mode</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
            <span class="n">black_bg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">draw_cross</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;decomposition_object&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">)):</span>
            <span class="n">var_exp</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;decomposition_object&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">[</span>
                <span class="n">component</span>
            <span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Component: </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">, Variance Explained: </span><span class="si">{</span><span class="n">var_exp</span><span class="si">:</span><span class="s2">2.2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Component: </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">][:,</span> <span class="n">component</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (AU)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timecourse (TR=</span><span class="si">{</span><span class="n">tr</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">][:,</span> <span class="n">component</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="n">tr</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="n">f</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="n">ipywidgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span>
        <span class="n">component_inspector</span><span class="p">,</span>
        <span class="n">component</span><span class="o">=</span><span class="n">ipywidgets</span><span class="o">.</span><span class="n">BoundedIntText</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Component&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">),</span>
        <span class="n">threshold</span><span class="o">=</span><span class="n">ipywidgets</span><span class="o">.</span><span class="n">BoundedFloatText</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Threshold&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span>
        <span class="p">),</span>
    <span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2020, Cosan Laboratory.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>